# Feature 02: Miglioramenti UI Dashboard e Dettaglio Run

## 1. Contesto

La baseline (00-baseline) e la feature 01 hanno introdotto la Dashboard con l'elenco delle Test Runs e la pagina di dettaglio Run con la lista dei Test Case. L'interfaccia attuale presenta alcune limitazioni:

- La pagina di dettaglio Run (`/runs/{id}`) non si aggiorna automaticamente durante l'esecuzione.
- Non è possibile navigare dalla Run al Progetto associato.
- Le statistiche globali nella Dashboard occupano spazio senza fornire valore aggiunto.
- Non esiste un meccanismo per chiudere manualmente una Run rimasta in stato `running`.
- L'indicatore visivo di successo/fallimento (✓/✗) è binario e non comunica la percentuale di successo.

Questa feature risolve tutti questi punti con miglioramenti mirati all'usabilità.

---

## 2. Requisiti Funzionali

### Modulo I: Aggiornamento Dinamico Dettaglio Run

* **FR-I1 (Auto-refresh pagina Run):** La pagina `/runs/{run_id}` deve aggiornare automaticamente la lista dei Test Case ogni **3 secondi**, utilizzando il pattern HTMX già adottato nella Dashboard. L'aggiornamento deve essere parziale (senza ricaricare l'intera pagina) e deve includere anche le statistiche della Run (totale test, passati, falliti, skippati, percentuale successo).

* **FR-I2 (Coerenza con stato Run):** L'auto-refresh deve attivarsi solo quando la Run è in stato `running`. Se la Run è in stato `completed` o `aborted`, l'auto-refresh non deve essere attivo (contenuto statico).

### Modulo J: Navigazione Run → Progetto

* **FR-J1 (Link al Progetto dalla Run):** Nella pagina di dettaglio di una Test Run (`/runs/{run_id}`), se la Run è associata a un Progetto (`project_id` non null), deve essere presente un link cliccabile al Progetto. Il link deve mostrare il nome del Progetto e navigare a `/projects/{project_id}`.

* **FR-J2 (Indicatore in Dashboard):** Nell'elenco delle Runs nella Dashboard, se una Run è associata a un Progetto, deve essere visibile il nome del Progetto come badge o etichetta cliccabile.

### Modulo K: Semplificazione Dashboard

* **FR-K1 (Rimozione statistiche globali):** Rimuovere dalla Dashboard le card di statistiche globali attualmente presenti: "Total Runs", "Passed Tests", "Failed Tests", "Success Rate". Queste informazioni non sono utili a colpo d'occhio e occupano spazio prezioso.

### Modulo L: Chiusura Manuale Run

* **FR-L1 (Pulsante chiusura Run):** Nella Dashboard, ogni Run in stato `running` deve mostrare un pulsante per la chiusura manuale. Il pulsante deve essere visivamente distinguibile (es. icona di stop o pulsante "Chiudi Run").

* **FR-L2 (Conferma utente):** Prima di chiudere una Run, il sistema deve richiedere una conferma esplicita all'utente (dialog di conferma nativo del browser o modale). Il messaggio deve indicare chiaramente l'azione irreversibile.

* **FR-L3 (Chiamata API):** La chiusura manuale deve invocare l'endpoint esistente `POST /api/runs/{run_id}/finish` e aggiornare la lista delle Run nella Dashboard senza ricaricare la pagina (via HTMX o fetch + refresh parziale).

### Modulo M: Indicatore Percentuale di Successo

* **FR-M1 (Sostituzione indicatore binario):** Nella Dashboard, sostituire l'indicatore visivo attuale (icona ✓ verde / ✗ rossa) con un **indicatore di percentuale di successo** che mostri la percentuale di test passati rispetto al totale.

* **FR-M2 (Gradiente colore):** L'indicatore deve utilizzare un gradiente di colore continuo basato sulla percentuale:
  - **0%** → Rosso (`#ef4444`)
  - **50%** → Giallo (`#eab308`)
  - **100%** → Verde (`#22c55e`)
  - I valori intermedi devono interpolare linearmente tra questi colori (es. 25% = rosso-arancione, 75% = giallo-verde).

* **FR-M3 (Formato visualizzazione):** La percentuale deve essere mostrata come testo numerico (es. "85%") all'interno o accanto a un indicatore circolare o badge colorato con il gradiente descritto.

* **FR-M4 (Casi speciali):**
  - Se la Run non ha test case (0 totali), non mostrare l'indicatore percentuale.
  - Se la Run è in stato `running`, mostrare l'indicatore con i dati parziali disponibili (aggiornato dall'auto-refresh).

---

## 3. Requisiti Non Funzionali

* **NFR-08 (Consistenza pattern HTMX):** I nuovi comportamenti dinamici (auto-refresh Run, chiusura manuale) devono utilizzare gli stessi pattern HTMX già presenti nel progetto.
* **NFR-09 (Nessuna dipendenza aggiuntiva):** Le modifiche devono essere implementate con le tecnologie già in uso (TailwindCSS, HTMX, vanilla JS). Nessuna libreria aggiuntiva.
* **NFR-10 (Retrocompatibilità UI):** Le modifiche non devono alterare il comportamento degli endpoint API esistenti.

---

## 4. Riepilogo Modifiche

| Area | Modifica |
|------|----------|
| `/runs/{run_id}` (pagina dettaglio) | Auto-refresh test case ogni 3s (solo se `running`) |
| `/runs/{run_id}` (header) | Link al Progetto associato (se presente) |
| Dashboard (runs list) | Badge progetto cliccabile su ogni Run |
| Dashboard (statistiche) | Rimozione card statistiche globali |
| Dashboard (runs list) | Pulsante "Chiudi Run" con conferma (solo `running`) |
| Dashboard (runs list) | Indicatore % successo con gradiente rosso→giallo→verde |
