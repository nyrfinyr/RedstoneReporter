{% extends "base.html" %}

{% block title %}Dashboard - RedstoneReporter{% endblock %}

{% block content %}
<!-- Header -->
<div class="page-header">
    <div class="page-header-info">
        <h1>Test Runs Dashboard</h1>
        <p>View and monitor your AI agent test executions</p>
    </div>
    <div>
        <span class="auto-refresh-badge">Auto-refresh: 5s</span>
    </div>
</div>

<!-- Test Runs List -->
<div class="card">
    <div class="card-header">
        <h2>Recent Test Runs</h2>
    </div>

    <!-- Runs container with auto-refresh -->
    <div id="runs-list"
         hx-get="/api/htmx/runs"
         hx-trigger="every 5s"
         hx-swap="innerHTML">

        {% include "partials/run_list.html" %}
    </div>
</div>

<script>
function closeRun(runId) {
    if (!confirm('Are you sure you want to close this Run? This action is irreversible.')) return;
    fetch('/api/runs/' + runId + '/finish', { method: 'POST' })
        .then(function(response) {
            if (!response.ok) throw new Error('Error while closing the Run');
            htmx.ajax('GET', '/api/htmx/runs', '#runs-list');
        })
        .catch(function(err) {
            alert('Error: ' + err.message);
        });
}
</script>
{% endblock %}
